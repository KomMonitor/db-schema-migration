<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:pro="http://www.liquibase.org/xml/ns/pro" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-latest.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">
    <changeSet author="kommonitor" id="1730806721971-41">
        <dropForeignKeyConstraint baseTableName="metadataindicators_defaultclassification" constraintName="fkaht0q849jrsr22wqslthqnvfu"/>
    </changeSet>
    <changeSet  author="kommonitor"  id="1730806721971-38">
        <dropAllForeignKeyConstraints
            baseTableName="metadataspatialunits_roles"
            baseTableSchemaName="public"/>
    </changeSet>
    <changeSet  author="kommonitor"  id="1730806721971-39">
        <dropAllForeignKeyConstraints
            baseTableName="indicatorspatialunits_roles"
            baseTableSchemaName="public"/>
    </changeSet>
    <changeSet  author="kommonitor"  id="1730806721971-44">
        <dropAllForeignKeyConstraints
            baseTableName="indicatorspatialunits_roles"
            baseTableSchemaName="public"/>
    </changeSet>
    <changeSet  author="kommonitor"  id="1730806721971-45">
        <dropAllForeignKeyConstraints
            baseTableName="indicatorspatialunits_roles"
            baseTableSchemaName="public"/>
    </changeSet>

    <changeSet author="kommonitor" id="1730806721971-48">
        <dropForeignKeyConstraint baseTableName="metadataindicators_defaultclassification" constraintName="fkq0us248wnb2j151csjtrkfa8n"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-100">
        <renameTable 
            oldTableName="roles"
            newTableName="permissions"/>
    </changeSet>
    <changeSet  author="kommonitor"  id="renameColumn-example">
        <renameColumn
            tableName="permissions"
            columnDataType="VARCHAR(255)"
            oldColumnName="roleid"
            newColumnName="permissionid"
            schemaName="public" />
    </changeSet>
    <changeSet  author="kommonitor"  id="renameColumn-example">
        <renameColumn
            tableName="permissions"
            columnDataType="VARCHAR(255)"
            oldColumnName="rolename"
            newColumnName="name"
            schemaName="public" />
    </changeSet>
    <changeSet author="kommonitor" id="addColumn-example">
        <addColumn
            schemaName= "public"
            tableName="permissions">
            <column name="permissiontype"
                type="varchar(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-101">
        <renameTable 
            oldTableName="metadatageoresources_roles"
            newTableName="metadatageoresources_permissions"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-102">
        <renameTable 
            oldTableName="metadatageoresources_roles"
            newTableName="metadatageoresources_permissions"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-2">
        <createTable tableName="metadataindicators_defaultclassificationmapping">
            <column name="dataset_id" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="mapping_id" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-4">
        <addUniqueConstraint columnNames="mapping_id" constraintName="uk_r7r7bnecj9nd2bqoqbrm5w7qu" tableName="metadataindicators_defaultclassificationmapping"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-5">
        <createTable tableName="defaultclassificationmappingitems">
            <column name="mappingid" type="VARCHAR(255)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="defaultclassificationmappingitems_pkey"/>
            </column>
            <column name="defaultcolorashex" type="VARCHAR(255)"/>
            <column name="defaultcustomrating" type="VARCHAR(255)"/>
            <column name="associatedindicatormetadata_datasetid" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-6">
        <createTable tableName="metadatageoresources_permissions">
            <column name="metadatageoresources_id" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="permission_id" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-7">
        <createTable tableName="metadataspatialunits_permissions">
            <column name="metadataspatialunits_id" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="permission_id" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-8">
        <addColumn tableName="indicatorspatialunits_roles">
            <column name="permission_id" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-9">
        <addColumn tableName="metadataindicators_roles">
            <column name="permission_id" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-10">
        <addColumn tableName="organizationalunits">
            <column name="ismandant" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-11">
        <addColumn tableName="organizationalunits">
            <column name="keycloakid" type="UUID">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-3">
        <addUniqueConstraint columnNames="keycloakid" constraintName="uk_hjlrkqdvjt7amjru2elp9uyq0" tableName="organizationalunits"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-12">
        <addColumn tableName="indicatorspatialunits">
            <column name="ispublic" type="BOOLEAN"/>
        </addColumn>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-13">
        <addColumn tableName="organizationalunits">
            <column name="mandant" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-14">
        <addColumn tableName="organizationalunits">
            <column name="parent" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-15">
        <addColumn tableName="indicatorspatialunits">
            <column name="owner_organizationalunitid" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-16">
        <addColumn tableName="metadataspatialunits">
            <column name="ispublic" type="BOOLEAN"/>
        </addColumn>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-17">
        <addColumn tableName="metadatageoresources">
            <column name="ispublic" type="BOOLEAN"/>
        </addColumn>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-18">
        <addColumn tableName="metadataindicators">
            <column name="ispublic" type="BOOLEAN"/>
        </addColumn>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-19">
        <addColumn tableName="metadataspatialunits">
            <column name="owner_organizationalunitid" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-20">
        <addColumn tableName="metadatageoresources">
            <column name="owner_organizationalunitid" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-21">
        <addColumn tableName="metadataindicators">
            <column name="owner_organizationalunitid" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-22">
        <addForeignKeyConstraint baseColumnNames="parent" baseTableName="organizationalunits" constraintName="fk3bm4ecg8sr4fyce8gpgcoifc2" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="organizationalunitid" referencedTableName="organizationalunits" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-23">
        <addForeignKeyConstraint baseColumnNames="owner_organizationalunitid" baseTableName="metadataspatialunits" constraintName="fk3j5hwqpw067o40i0pc5n7y81w" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="organizationalunitid" referencedTableName="organizationalunits" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-24">
        <addForeignKeyConstraint baseColumnNames="owner_organizationalunitid" baseTableName="indicatorspatialunits" constraintName="fk5qiyu7wg29c5u5gne280ha0h5" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="organizationalunitid" referencedTableName="organizationalunits" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-25">
        <addForeignKeyConstraint baseColumnNames="permission_id" baseTableName="indicatorspatialunits_roles" constraintName="fk6mfgybae58am87occ1pvxqb35" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="permissionid" referencedTableName="permissions" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-26">
        <addForeignKeyConstraint baseColumnNames="permission_id" baseTableName="metadataspatialunits_permissions" constraintName="fk7ls7o1jla5e9dldak6yrrqxdq" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="permissionid" referencedTableName="permissions" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-27">
        <addForeignKeyConstraint baseColumnNames="mandant" baseTableName="organizationalunits" constraintName="fk7mscc9wm82n23nmirr394h0ne" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="organizationalunitid" referencedTableName="organizationalunits" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-28">
        <addForeignKeyConstraint baseColumnNames="permission_id" baseTableName="metadatageoresources_permissions" constraintName="fk87qg1sgxo3pcmo3189tlas2cu" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="permissionid" referencedTableName="permissions" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-29">
        <addForeignKeyConstraint baseColumnNames="metadataspatialunits_id" baseTableName="metadataspatialunits_permissions" constraintName="fk9d89b761lh3m7dn612cw06888" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="datasetid" referencedTableName="metadataspatialunits" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-30">
        <addForeignKeyConstraint baseColumnNames="owner_organizationalunitid" baseTableName="metadataindicators" constraintName="fkf7wi42jyhwx6yvdxgjwr84dam" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="organizationalunitid" referencedTableName="organizationalunits" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-31">
        <addForeignKeyConstraint baseColumnNames="owner_organizationalunitid" baseTableName="metadatageoresources" constraintName="fkhgfrv0npwlxkfadhhanw1e0dh" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="organizationalunitid" referencedTableName="organizationalunits" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-32">
        <addForeignKeyConstraint baseColumnNames="metadatageoresources_id" baseTableName="metadatageoresources_permissions" constraintName="fkis8vhkd37va7ltxydm5y5weyi" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="datasetid" referencedTableName="metadatageoresources" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-33">
        <addForeignKeyConstraint baseColumnNames="permission_id" baseTableName="metadataindicators_roles" constraintName="fkk4bshdttlovc1h5p2djnf90hg" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="permissionid" referencedTableName="permissions" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-34">
        <addForeignKeyConstraint baseColumnNames="associatedindicatormetadata_datasetid" baseTableName="defaultclassificationmappingitems" constraintName="fknetb3p2j6vppdhlexpycdj3he" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="datasetid" referencedTableName="metadataindicators" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-35">
        <addForeignKeyConstraint baseColumnNames="dataset_id" baseTableName="metadataindicators_defaultclassificationmapping" constraintName="fkqelnc9v6qm8di2e9t41nkpl0o" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="datasetid" referencedTableName="metadataindicators" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-36">
        <addForeignKeyConstraint baseColumnNames="organizationalunit" baseTableName="permissions" constraintName="fkrf83pb1ulbpvgjq14ndhy15nx" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="organizationalunitid" referencedTableName="organizationalunits" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-37">
        <addForeignKeyConstraint baseColumnNames="mapping_id" baseTableName="metadataindicators_defaultclassificationmapping" constraintName="fktohsyfr0y3tihb4irt0jlpkdv" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="mappingid" referencedTableName="defaultclassificationmappingitems" validate="true"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-49">
        <dropUniqueConstraint constraintName="uk_4e4j2y5pakop2tvkrh6ww35ow" tableName="metadataindicators_regionalreferencevalues"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-50">
        <dropUniqueConstraint constraintName="uk_flbbiupqlw6112xnf5t2v9c45" tableName="metadataindicators_defaultclassification"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-51">
        <dropTable tableName="defaultclassificationmappingitemtype"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-52">
        <dropTable tableName="metadatageoresources_roles"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-53">
        <dropTable tableName="metadataindicators_defaultclassification"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-54">
        <dropTable tableName="metadataindicators_regionalreferencevalues"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-55">
        <dropTable tableName="metadataspatialunits_roles"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-56">
        <dropTable tableName="regionalreferencevaluetype"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-57">
        <dropTable tableName="roles"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-58">
        <dropColumn columnName="classificationmethod" tableName="metadataindicators"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-59">
        <dropColumn columnName="numclasses" tableName="metadataindicators"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-60">
        <dropColumn columnName="poimarkerstyle" tableName="metadatageoresources"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-61">
        <dropColumn columnName="poimarkertext" tableName="metadatageoresources"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-62">
        <dropColumn columnName="roles_id" tableName="indicatorspatialunits_roles"/>
    </changeSet>
    <changeSet author="kommonitor" id="1730806721971-63">
        <dropColumn columnName="roles_id" tableName="metadataindicators_roles"/>
    </changeSet>
</databaseChangeLog>
